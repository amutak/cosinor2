periodogram<-function(data, timecol, firstsubj, lastsubj, na.action){
  periodogram<-matrix()
  if (lastsubj - firstsubj == 0) {
    colnames(data)[timecol]<-"Time"
    colnames(data)[firstsubj]<-"Subjy"
    for (i in 3:nrow(data)) {
      cosinor<-cosinor.lm(Subjy~time(Time),data=data,na.action=na.action,period=i)
      periodogram[[i]]<-cosinor.PR(cosinor)[[2]]
    }
  }
  else {
    for (i in 3:nrow(data)){
      cosinor<-population.cosinor.lm(data = data, timecol = timecol, firstsubj = firstsubj, lastsubj = lastsubj, na.action = na.action, period = i)
      periodogram[[i]]<-cosinor.PR(cosinor)[[2]]
    }
  }
  periods<-as.numeric(periodogram)
  periodogram<-data.frame(periodogram)
  rows<-(nrow(periodogram))
  plot<-ggplot(periodogram,aes(x=1:rows))+
    geom_point(aes(y=periodogram)) +
    geom_line(aes(y=periodogram)) +
    labs(x = "Period", y = "Coefficient of determination")
  best<-(which(periods == max(periods,na.rm=T)))
  print(paste("The best fitting period is",best))
  return(plot)
}
